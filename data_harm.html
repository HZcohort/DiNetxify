

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data harmonization &mdash; DiNetxify  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
      <script src="_static/doctools.js?v=888ff710"></script>
      <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Three-dimensional disease network analysis" href="3d_analysis.html" />
    <link rel="prev" title="Input data preparation" href="data_prep.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            DiNetxify
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data_prep.html">Input data preparation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data harmonization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#initializing-the-data-object">Initializing the data object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-phenotype-data">Load phenotype data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-medical-record-data">Load medical record data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#save-diseasenetworkdata-object">Save DiseaseNetworkData object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reload-diseasenetworkdata-object">Reload DiseaseNetworkData object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3d_analysis.html">Three-dimensional disease network analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="visual.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="table.html">Result tables description</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="log.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DiNetxify</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Data harmonization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/data_harm.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-harmonization">
<h1>Data harmonization<a class="headerlink" href="#data-harmonization" title="Permalink to this heading"></a></h1>
<p>Data harmonization involves loading and merging the <strong>phenotype data</strong> and <strong>medical record data</strong> into a single <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object for analysis. During this process, the software ensures consistent coding (e.g., converting diagnosis codes to phecodes) and standardized formatting (e.g., datetime parsing for diagnosis and follow-up periods).</p>
<section id="initializing-the-data-object">
<h2>Initializing the data object<a class="headerlink" href="#initializing-the-data-object" title="Permalink to this heading"></a></h2>
<p>First, import the <em><strong>DiNetxify</strong></em> package and instantiate a <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object with your chosen study design, phecode level, and any optional parameters. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">DiNetxify</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dnt</span>  

<span class="c1"># For a matched cohort study  </span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dnt</span><span class="o">.</span><span class="n">DiseaseNetworkData</span><span class="p">(</span>  
    <span class="n">study_design</span><span class="o">=</span><span class="s1">&#39;matched cohort&#39;</span><span class="p">,</span>  
    <span class="n">phecode_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
<span class="p">)</span>  

<span class="c1"># For a standard cohort study  </span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dnt</span><span class="o">.</span><span class="n">DiseaseNetworkData</span><span class="p">(</span>  
    <span class="n">study_design</span><span class="o">=</span><span class="s1">&#39;cohort&#39;</span><span class="p">,</span>  
    <span class="n">phecode_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
<span class="p">)</span>  

<span class="c1"># For an exposed-only cohort study  </span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dnt</span><span class="o">.</span><span class="n">DiseaseNetworkData</span><span class="p">(</span>  
    <span class="n">study_design</span><span class="o">=</span><span class="s1">&#39;exposed-only cohort&#39;</span><span class="p">,</span>  
    <span class="n">phecode_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
<span class="p">)</span>  
</pre></div>
</div>
<ul class="simple">
<li><p><strong>study_design</strong> – Type of study design. Options: <code class="docutils literal notranslate"><span class="pre">'cohort'</span></code>, <code class="docutils literal notranslate"><span class="pre">'matched</span> <span class="pre">cohort'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'exposed-only</span> <span class="pre">cohort'</span></code>. <em>(Default: ‘cohort’)</em>.</p></li>
<li><p><strong>phecode_level</strong> – Level of phecode to use for grouping diagnoses. Level 1 provides broader categories (~585 conditions) while level 2 offers more detailed categories (~1257 conditions). For smaller datasets, level 1 is recommended to maintain statistical power; for larger datasets, level 2 can provide finer granularity. <em>(Options: 1 or 2; Default: 1)</em>.</p></li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul class="simple">
<li><p><strong>min_required_icd_codes</strong> – Minimum number of ICD diagnosis records mapping to the same phecode for that phecode to be considered “present” in an individual. For example, <code class="docutils literal notranslate"><span class="pre">min_required_icd_codes=2</span></code> means a single occurrence of a code isn’t enough to count the person as having that phecode; at least two occurrences are required. Ensure your medical record are comprehensive (not limited to first occurrences) if using this parameter. <em>(Default: 1)</em>.</p></li>
<li><p><strong>date_fmt</strong> – Date format of the <strong>Index date</strong> and <strong>End date</strong> columns in your phenotype data. <em>(Default: ‘%Y-%m-%d’, i.e. YYYY-MM-DD)</em>.</p></li>
<li><p><strong>phecode_version</strong> – Phecode version for mapping diagnosis codes. Currently, version <code class="docutils literal notranslate"><span class="pre">'1.2'</span></code> is the recommended official version (with mapping files for ICD-9-CM/WHO and ICD-10-CM/WHO). An unofficial <code class="docutils literal notranslate"><span class="pre">'1.3a'</span></code> is available in the package for special use cases but is <strong>not</strong> recommended for general use. <em>(Default: ‘1.2’)</em>.</p></li>
</ul>
</section>
<section id="load-phenotype-data">
<h2>Load phenotype data<a class="headerlink" href="#load-phenotype-data" title="Permalink to this heading"></a></h2>
<p>After initializing the <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object, use the <code class="docutils literal notranslate"><span class="pre">phenotype_data()</span></code> method to load your phenotype data file. You need to provide the file path, a dictionary mapping the required column names to your file’s column headers, and a list of any additional covariate column names.</p>
<p>Below are examples demonstrating how to load the dummy phenotype dataset under different study designs. The dummy file is structured for a matched cohort study, but it can be adapted for other designs by dropping certain columns when mapping: if you omit the <strong>Match ID</strong> column in the mapping, the data will be treated as a standard cohort (ignoring the matching groups); if you omit both <strong>Match ID</strong> and <strong>Exposure</strong>, it will be treated as an exposed-only cohort (all individuals considered “exposed”).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load phenotype data for a matched cohort study  </span>
<span class="n">col_dict</span> <span class="o">=</span> <span class="p">{</span>  
    <span class="s1">&#39;Participant ID&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Exposure&#39;</span><span class="p">:</span> <span class="s1">&#39;exposure&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Sex&#39;</span><span class="p">:</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Index date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_start&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;End date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_end&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Match ID&#39;</span><span class="p">:</span> <span class="s1">&#39;group_id&#39;</span>  
<span class="p">}</span>  
<span class="n">covariates_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;BMI&#39;</span><span class="p">]</span>  
<span class="n">data</span><span class="o">.</span><span class="n">phenotype_data</span><span class="p">(</span>  
    <span class="n">phenotype_data_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/test/data/dummy_phenotype.csv&quot;</span><span class="p">,</span>  
    <span class="n">column_names</span><span class="o">=</span><span class="n">col_dict</span><span class="p">,</span>  
    <span class="n">covariates</span><span class="o">=</span><span class="n">covariates_list</span>  
<span class="p">)</span>  

<span class="c1"># Load phenotype data for a standard cohort study (no matching)  </span>
<span class="n">col_dict</span> <span class="o">=</span> <span class="p">{</span>  
    <span class="s1">&#39;Participant ID&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Exposure&#39;</span><span class="p">:</span> <span class="s1">&#39;exposure&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Sex&#39;</span><span class="p">:</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Index date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_start&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;End date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_end&#39;</span>  
<span class="p">}</span>  
<span class="n">covariates_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;BMI&#39;</span><span class="p">]</span>  
<span class="n">data</span><span class="o">.</span><span class="n">phenotype_data</span><span class="p">(</span>  
    <span class="n">phenotype_data_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/test/data/dummy_phenotype.csv&quot;</span><span class="p">,</span>  
    <span class="n">column_names</span><span class="o">=</span><span class="n">col_dict</span><span class="p">,</span>  
    <span class="n">covariates</span><span class="o">=</span><span class="n">covariates_list</span>  
<span class="p">)</span>  

<span class="c1"># Load phenotype data for an exposed-only cohort study (only exposed group, no comparator)  </span>
<span class="n">col_dict</span> <span class="o">=</span> <span class="p">{</span>  
    <span class="s1">&#39;Participant ID&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Sex&#39;</span><span class="p">:</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;Index date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_start&#39;</span><span class="p">,</span>  
    <span class="s1">&#39;End date&#39;</span><span class="p">:</span> <span class="s1">&#39;date_end&#39;</span>  
<span class="p">}</span>  
<span class="n">covariates_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;BMI&#39;</span><span class="p">]</span>  
<span class="n">data</span><span class="o">.</span><span class="n">phenotype_data</span><span class="p">(</span>  
    <span class="n">phenotype_data_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/test/data/dummy_phenotype.csv&quot;</span><span class="p">,</span>  
    <span class="n">column_names</span><span class="o">=</span><span class="n">col_dict</span><span class="p">,</span>  
    <span class="n">covariates</span><span class="o">=</span><span class="n">covariates_list</span>  
<span class="p">)</span>  
</pre></div>
</div>
<ul class="simple">
<li><p><strong>phenotype_data_path</strong> – Path to your phenotype data file (CSV or TSV).</p></li>
<li><p><strong>column_names</strong> – Dictionary mapping the required column names (<code class="docutils literal notranslate"><span class="pre">'Participant</span> <span class="pre">ID'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Index</span> <span class="pre">date'</span></code>, <code class="docutils literal notranslate"><span class="pre">'End</span> <span class="pre">date'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Sex'</span></code>, and depending on design <code class="docutils literal notranslate"><span class="pre">'Exposure'</span></code> and <code class="docutils literal notranslate"><span class="pre">'Match</span> <span class="pre">ID'</span></code>) to the corresponding column headers in your file. Include <code class="docutils literal notranslate"><span class="pre">'Exposure'</span></code> for cohort and matched cohort designs, and include <code class="docutils literal notranslate"><span class="pre">'Match</span> <span class="pre">ID'</span></code> only for matched cohorts.</p></li>
<li><p><strong>covariates</strong> – List of additional covariate column names to load (if any). Use an empty list <code class="docutils literal notranslate"><span class="pre">[]</span></code> if there are none. The function will automatically detect each covariate’s type and process it appropriately (e.g., encode categorical variables). For continuous covariates, any rows with missing values will be dropped; for categorical covariates, missing values will be categorized as “NA”.</p></li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul class="simple">
<li><p><strong>is_single_sex</strong> – If your cohort contains only one sex (all male or all female), set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> so the software knows to treat the Sex column accordingly. <em>(Default: False)</em>.</p></li>
<li><p><strong>force</strong> – If <code class="docutils literal notranslate"><span class="pre">False</span></code>, the method will raise an error if phenotype data has already been loaded into this <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object (to prevent accidental overwrite). Setting <code class="docutils literal notranslate"><span class="pre">force=True</span></code> will overwrite any existing data in the object with the new data. <em>(Default: False)</em>.</p></li>
</ul>
<p><strong>After loading phenotype data:</strong></p>
<p>Once the phenotype data is loaded, you can inspect the basic characteristics by printing the <code class="docutils literal notranslate"><span class="pre">data</span></code> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  
<span class="c1"># Example output (for a matched cohort study):  </span>
<span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">DiNetxify.DiseaseNetworkData  </span>

<span class="sd">Study design: matched cohort  </span>

<span class="sd">Phenotype data  </span>
<span class="sd">Total number of individuals: 60,000 (10,000 exposed and 50,000 unexposed)  </span>
<span class="sd">The average group size is: 6.00  </span>
<span class="sd">Average follow-up years: 10.44 (exposed) and 10.46 (unexposed)  </span>

<span class="sd">Warning: 102 exposed individuals and 440 unexposed individuals have negative or zero follow-up time.  </span>
<span class="sd">Consider removing them before merge.  </span>
<span class="sd">&quot;&quot;&quot;</span>  

</pre></div>
</div>
<p>The printed summary confirms the number of individuals, breakdown by exposure, average matching group size (for matched cohorts), and average follow-up times. Warnings are provided if any participants have non-positive follow-up lengths, which you may want to address (e.g., by removing those individuals) before proceeding.</p>
<p>Additionally, you can generate a basic descriptive table (Table 1) of the phenotype data using the <code class="docutils literal notranslate"><span class="pre">Table1()</span></code> method. This returns a pandas DataFrame summarizing each variable (e.g., medians/IQRs for continuous variables, counts/percentages for categorical variables) and performing simple statistical comparisons between exposed and unexposed groups:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">table1_df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Table1</span><span class="p">()</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">table1_df</span><span class="p">)</span>  
<span class="c1"># Example (truncated) output:  </span>
<span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">                   Variable exposure=1 (n=10,000) exposure=0 (n=50,000)  Test and p-value</span>
<span class="sd">0        _age (median, IQR)   57.08 (48.91-65.32)   57.05 (48.87-65.35)  Mann-Whitney U test p-value=9.824e-01</span>
<span class="sd">1   follow_up (median, IQR)     9.18 (5.77-13.70)     9.22 (5.80-13.75)  Mann-Whitney U test p-value=6.806e-01</span>
<span class="sd">2                sex (n, %)                                               </span>
<span class="sd">3                sex=Female        5,045 (50.45%)       25,225 (50.45%)   </span>
<span class="sd">4                  sex=Male        4,955 (49.55%)       24,775 (49.55%)  Chi-squared test p-value=1.000e+00 </span>
<span class="sd">5                BMI (n, %)                                              ...</span>
<span class="sd">6                    BMI=c2        1,945 (19.45%)       10,170 (20.34%)   </span>
<span class="sd">7                    BMI=c4        2,022 (20.22%)       10,022 (20.04%)   </span>
<span class="sd">8                    BMI=c5        2,002 (20.02%)       10,031 (20.06%)   </span>
<span class="sd">9                    BMI=c1        1,999 (19.99%)        9,952 (19.90%)   </span>
<span class="sd">10                   BMI=c3        2,032 (20.32%)        9,825 (19.65%)  Chi-squared test p-value=2.552e-01     </span>
<span class="sd">&quot;&quot;&quot;</span>  
</pre></div>
</div>
<p>This Table 1 gives a quick overview of how the exposed and unexposed groups compare on key variables. You can save this <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to a CSV/TSV/Excel file using pandas if needed.</p>
</section>
<section id="load-medical-record-data">
<h2>Load medical record data<a class="headerlink" href="#load-medical-record-data" title="Permalink to this heading"></a></h2>
<p>After loading the phenotype data, use the <code class="docutils literal notranslate"><span class="pre">merge_medical_records()</span></code> method to load and merge each medical record file. You will call this method for each separate file (e.g., one for ICD-10 and one for ICD-9 in our dummy data). Provide the file path, specify the ICD coding standard used in that file, and a dictionary mapping required columns. The following example code shows how to load the dummy EHR ICD-10 and ICD-9 files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Merge the first medical record file (dummy_EHR_ICD10.csv)  </span>
<span class="n">data</span><span class="o">.</span><span class="n">merge_medical_records</span><span class="p">(</span>  
    <span class="n">medical_records_data_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/test/data/dummy_EHR_ICD10.csv&quot;</span><span class="p">,</span>  
    <span class="n">diagnosis_code</span><span class="o">=</span><span class="s1">&#39;ICD-10-WHO&#39;</span><span class="p">,</span>  
    <span class="n">column_names</span><span class="o">=</span><span class="p">{</span>  
        <span class="s1">&#39;Participant ID&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>  
        <span class="s1">&#39;Diagnosis code&#39;</span><span class="p">:</span> <span class="s1">&#39;diag_icd10&#39;</span><span class="p">,</span>  
        <span class="s1">&#39;Date of diagnosis&#39;</span><span class="p">:</span> <span class="s1">&#39;dia_date&#39;</span>  
    <span class="p">}</span>  
<span class="p">)</span>  

<span class="c1"># Merge the second medical record file (dummy_EHR_ICD9.csv)  </span>
<span class="n">data</span><span class="o">.</span><span class="n">merge_medical_records</span><span class="p">(</span>  
    <span class="n">medical_records_data_path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;/test/data/dummy_EHR_ICD9.csv&quot;</span><span class="p">,</span>  
    <span class="n">diagnosis_code</span><span class="o">=</span><span class="s2">&quot;ICD-9-WHO&quot;</span><span class="p">,</span>  
    <span class="n">column_names</span><span class="o">=</span><span class="p">{</span>  
        <span class="s1">&#39;Participant ID&#39;</span><span class="p">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span>  
        <span class="s1">&#39;Diagnosis code&#39;</span><span class="p">:</span> <span class="s1">&#39;diag_icd9&#39;</span><span class="p">,</span>  
        <span class="s1">&#39;Date of diagnosis&#39;</span><span class="p">:</span> <span class="s1">&#39;dia_date&#39;</span>  
    <span class="p">}</span>  
<span class="p">)</span>  

</pre></div>
</div>
<ul class="simple">
<li><p><strong>medical_records_data_path</strong> – Path to a medical record data file (CSV or TSV).</p></li>
<li><p><strong>diagnosis_code</strong> – The diagnosis coding system used in that file. Options include <code class="docutils literal notranslate"><span class="pre">'ICD-9-CM'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ICD-9-WHO'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ICD-10-CM'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ICD-10-WHO'</span></code> (case-sensitive).</p></li>
<li><p><strong>column_names</strong> – Dictionary mapping the required column names (<code class="docutils literal notranslate"><span class="pre">'Participant</span> <span class="pre">ID'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Diagnosis</span> <span class="pre">code'</span></code>, <code class="docutils literal notranslate"><span class="pre">'Date</span> <span class="pre">of</span> <span class="pre">diagnosis'</span></code>) to your file’s column headers.</p></li>
</ul>
<p><strong>Optional parameters:</strong></p>
<ul class="simple">
<li><p><strong>date_fmt</strong> – Date format of the <strong>Date of diagnosis</strong> column in this file. If not provided, it defaults to the same format used for phenotype dates (<code class="docutils literal notranslate"><span class="pre">date_fmt</span></code> specified in the <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> initialization).</p></li>
<li><p><strong>chunksize</strong> – If the file is very large, you can specify a number of rows to read per chunk (the function will stream through the file in chunks to manage memory usage). <em>(Default: 1,000,000 rows per chunk.)</em></p></li>
</ul>
<p><strong>During data loading:</strong></p>
<p>As each medical record file is processed, <em><strong>DiNetxify</strong></em> will output progress messages and basic stats. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">1,000,000 records read, 1,000,000 left after filltering on participant ID/exclusion list of diagnosis codes, 0 records with missing values excluded.</span>
<span class="sd">1,668,795 records read, 1,668,795 left after filltering on participant ID/exclusion list of diagnosis codes, 0 records with missing values excluded.</span>
<span class="sd">Total: 1,668,795 diagnosis records processed, 0 records with missing values were excluded.</span>
<span class="sd">1,286,386 diagnosis records mapped to phecode without truncating.</span>
<span class="sd">0 diagnosis records mapped to phecode after truncating to 4 digits.</span>
<span class="sd">72,073 diagnosis records mapped to phecode after truncating to 3 digits.</span>
<span class="sd">302,908 diagnosis records not mapped to any phecode.</span>
<span class="sd">Phecode diagnosis records successfully merged (18,486 invalid records were not merged, typically with diagnosis date later than date of follow-up end)</span>

<span class="sd">1 medical records data already merged, merging with a new one.</span>
<span class="sd">10,188 records read, 10,188 left after filltering on participant ID/exclusion list of diagnosis codes, 0 records with missing values excluded.</span>
<span class="sd">Total: 10,188 diagnosis records processed, 0 records with missing values were excluded.</span>
<span class="sd">9,711 diagnosis records mapped to phecode without truncating.</span>
<span class="sd">0 diagnosis records mapped to phecode after truncating to 4 digits.</span>
<span class="sd">266 diagnosis records mapped to phecode after truncating to 3 digits.</span>
<span class="sd">211 diagnosis records not mapped to any phecode.</span>
<span class="sd">Phecode diagnosis records successfully merged (0 invalid records were not merged, typically with diagnosis date later than date of follow-up end)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>From these logs, you can see how many records were read and included, how many were excluded (e.g., missing values or out-of-follow-up-range dates), and how many diagnosis codes were successfully mapped to phecodes versus not mapped. The logs also indicate when multiple files are being merged sequentially.</p>
<p><strong>After loading medical record data:</strong></p>
<p>After merging all medical record files, you can print the <code class="docutils literal notranslate"><span class="pre">data</span></code> object again to see a summary of the combined dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  
<span class="c1"># Example output (matched cohort study):  </span>
<span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">Merged Medical records  </span>
<span class="sd">2 medical record files with 1,678,983 diagnosis records were merged (0 with missing values).  </span>
<span class="sd">Average number of disease diagnoses during follow-up: 18.99 (exposed) and 7.31 (unexposed)  </span>
<span class="sd">Average number of disease diagnoses before follow-up: 8.40 (exposed) and 3.46 (unexposed)  </span>

<span class="sd">Warning: 102 exposed individuals and 440 unexposed individuals have negative or zero follow-up time.  </span>
<span class="sd">Consider removing them before merge.  </span>
<span class="sd">Warning: 18.15% of ICD-10-WHO codes were not mapped to phecodes for file /test/data/dummy_EHR_ICD10.csv.  </span>
<span class="sd">Warning: 2.07% of ICD-9-WHO codes were not mapped to phecodes for file /test/data/dummy_EHR_ICD9.csv.  </span>
<span class="sd">&quot;&quot;&quot;</span>  
</pre></div>
</div>
<p>This output confirms the number of diagnosis records merged and provides average counts of diagnoses per person (during and before follow-up, by exposure group). Warnings indicate the percentage of codes that could not be mapped to a phecode for each file, so you’re aware of any unmapped codes.</p>
</section>
<section id="save-diseasenetworkdata-object">
<h2>Save DiseaseNetworkData object<a class="headerlink" href="#save-diseasenetworkdata-object" title="Permalink to this heading"></a></h2>
<p>At this stage, after loading phenotype and medical record data, you may want to save the <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object for later use. Saving allows you to reuse the prepared data without re-reading and processing raw files each time, facilitating reproducibility and easy sharing of the processed data. <em><strong>DiNetxify</strong></em> provides two methods: <code class="docutils literal notranslate"><span class="pre">save()</span></code> (which uses Python’s pickle serialization, saving to a compressed <code class="docutils literal notranslate"><span class="pre">.pkl.gz</span></code> file) and <code class="docutils literal notranslate"><span class="pre">save_npz()</span></code> (which saves to a compressed NumPy <code class="docutils literal notranslate"><span class="pre">.npz</span></code> file). You can use either or both depending on your needs. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the data object to a gzipped pickle file  </span>
<span class="n">data</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/your/project/path/cohort_data&#39;</span><span class="p">)</span>  
<span class="c1"># (This will produce a file named &quot;cohort_data.pkl.gz&quot;)  </span>

<span class="c1"># Save the data object to a NumPy .npz file  </span>
<span class="n">data</span><span class="o">.</span><span class="n">save_npz</span><span class="p">(</span><span class="s1">&#39;/your/project/path/cohort_data&#39;</span><span class="p">)</span>  
<span class="c1"># (This will produce a file named &quot;cohort_data.npz&quot;)</span>
</pre></div>
</div>
<p>You do not need to add the file extension in the path; the functions will append <code class="docutils literal notranslate"><span class="pre">.pkl.gz</span></code> or <code class="docutils literal notranslate"><span class="pre">.npz</span></code> automatically. Make sure to choose a directory where you have write permissions and enough storage space (the files can be large if your dataset is large).</p>
</section>
<section id="reload-diseasenetworkdata-object">
<h2>Reload DiseaseNetworkData object<a class="headerlink" href="#reload-diseasenetworkdata-object" title="Permalink to this heading"></a></h2>
<p>If you have previously saved a <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object, you can reload it instead of re-reading all input files. This is especially useful for large datasets or when sharing the processed object with collaborators. To reload, first instantiate a new <code class="docutils literal notranslate"><span class="pre">DiseaseNetworkData</span></code> object with the same <code class="docutils literal notranslate"><span class="pre">study_design</span></code> and <code class="docutils literal notranslate"><span class="pre">phecode_level</span></code> that the data was created with, then call the corresponding load function (<code class="docutils literal notranslate"><span class="pre">load()</span></code> or <code class="docutils literal notranslate"><span class="pre">load_npz()</span></code>). For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">DiNetxify</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dnt</span>  

<span class="c1"># Create a new DiseaseNetworkData object with the same design/parameters  </span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dnt</span><span class="o">.</span><span class="n">DiseaseNetworkData</span><span class="p">(</span>  
    <span class="n">study_design</span><span class="o">=</span><span class="s1">&#39;cohort&#39;</span><span class="p">,</span>  
    <span class="n">phecode_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
<span class="p">)</span>  

<span class="c1"># Load from a .pkl.gz file  </span>
<span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/your/project/path/cohort_data&#39;</span><span class="p">)</span>  

<span class="c1"># Or load from a .npz file  </span>
<span class="n">data</span><span class="o">.</span><span class="n">load_npz</span><span class="p">(</span><span class="s1">&#39;/your/project/path/cohort_data&#39;</span><span class="p">)</span>  
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_prep.html" class="btn btn-neutral float-left" title="Input data preparation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="3d_analysis.html" class="btn btn-neutral float-right" title="Three-dimensional disease network analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>